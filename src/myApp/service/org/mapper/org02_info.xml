<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  

<mapper namespace="org02_info">

<!--  resultMap 이름은 반드시 mapper 이어야 한다. -->

<resultMap 	id="mapper" type="myApp.client.org.model.OrgInfoModel" >
	<id  	column="org02_info_id"		property="infoId"/>
	<result column="org02_code_id"		property="codeId"/>
	<result column="org02_parent_id"	property="parentId"/>
	<result column="org02_mod_date"		property="modDate"/>
	<result column="org02_mod_cd"		property="modCode"/>
	<result column="org02_mod_nm"		property="modName"/>
	<result column="org02_mod_detail"	property="modDetail"/>
	<result column="org02_level_cd"		property="levelCode"/>
	<result column="org02_level_nm"		property="levelName"/>
	<result column="org02_kor_nm"		property="korName"/>
	<result column="org02_short_nm"		property="shortName"/>
	<result column="org02_eng_nm"		property="engName"/>
	<result column="org02_sort_order"	property="sortOrder"/>
	<result column="org02_note"			property="note"/>	
</resultMap>

<select id="selectById" resultMap="mapper" parameterType="Long" > 
	select 	a.*, 
			f_cdnm('OrgModeCode', org02_mode_cd) org02_mod_nm, 
			f_cdnm('OrgLevelCode', org02_level_cd) org02_level_nm
	from 	org02_info a
	where	org02_info_id = #{infoId} 
</select>

<select id="selectByParentId" resultMap="mapper" parameterType="HashMap"> 
	select 	a.*, 
			b.*, 
			f_cdnm('OrgModeCode', org02_mod_cd) org02_mod_nm, 
			f_cdnm('OrgLevelCode', org02_level_cd) org02_level_nm
	from 	org02_info a, 
			org01_code b
	where 	org01_company_id = #{companyId}
	and		org02_code_id = org01_code_id
	and		org02_parent_id = #{parentId}
	and		#{modDate} between org01_open_date and org01_close_date
	and		org02_mod_date 
			= ( select 	max(x.org02_mod_date) 
				from 	org02_info x
				where 	x.org02_code_id = a.org02_code_id 
				and		x.org02_mod_date &lt;= #{modDate} )
	order by org02_sort_order
</select>



</mapper>

